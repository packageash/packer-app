#!/bin/bash

version=1.7
versionformated=1.7

plus=0.1

newversion=$(( $versionformated + $plus ))

function validate_url(){
  if [[ `wget -S --spider $1  2>&1 | grep 'HTTP/1.1 200 OK'` ]]; then echo "New Packer Update use packer update $newversion"; fi
}

function dosomething(){
   sudo rm /usr/local/bin/packer
    sudo mkdir /home/packerupdatecache 
    sudo wget https://github.com/packageash/packer-app-sudo/releases/download/$2/packer
    sudo mv packer /home/packerupdatecache
    sudo cd /home/packerupdatecache
    sudo mv packer /usr/local/bin
    sudo cd
    sudo rm /home/packerupdatecache
    sudo clear
    sudo echo Upgraded To Packer Version $2
    exit
}

updateurl=https://github.com/packageash/packer-app-sudo/releases/download/$newversion/packer

clear

case $1 in

  install)
    sudo mkdir /home/packercache
    sudo wget https://github.com/packageash/repo/releases/download/1.0-repo-for-1.5-repo-update/$2
    sudo mv $2 /home/packercache
    cd /home/packercache
    sudo mv $2 /usr/local/bin
    echo Cleaning Up
    sudo rm -r /home/packercache
    sudo clear
    sudo chmod 755 /usr/local/bin/$2
    echo Installed $2
    echo $2 1.0
    ;;

  uninstall)
    sudo rm /usr/local/bin/$2
    sudo clear
    sudo echo Uninstalled $2
    ;;

update)
    sudo echo Updateing To Packer $2
    if `validate_url https://github.com/packageash/packer-app-sudo/releases/download/$2/packer >/dev/null`; then dosomething; else echo "Not An Update Yet Or Typed Wrong && exit"; fi
    ;;
    
  --version)
  echo Packer Version $version
    ;;
    
    packages)
    echo 2 Packages Found In Repo:
    echo Donut Thingy
    echo Installable By packer install donut
    echo Can Be Magneted: No Right Now Because I Moved The Repo That Its Requested From
    echo Neofetch
    echo Installable By packer install neofetch
    echo Can Be Magneted: Yes
    echo End Of Package List
    ;;
    
    magnet)
    sudo mkdir ~/MagnetedCodePacker
    sudo echo Magenting!
    sudo cp /usr/local/bin/$2 ~/MagnetedCodePacker/$2
    ;;
    
    
  *)
    echo "Nothing Picked To (Un)Install"
    echo For A Package Request Ask PokeyManatee4 To Add A New Package To The Repo And What The Package Or Why I Should Add It To The Repo
    ;;
esac
